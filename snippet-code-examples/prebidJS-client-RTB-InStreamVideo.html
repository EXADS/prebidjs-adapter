<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Prebid.js Article1</title>

    <script src="js/prebid.js"></script>
    <!-- Fluid Player CSS and JS -->
    <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>
    <script>
        // Client Conf start
        //http://rtb.exads.rocks/rtb.php?idzone=5102563&fid=e14da4477edb2effaedd1e2f56501f1151f588fc
        let zoneId = 5147489;
        let fid = "72f7f7602626994a76ada610ce3aa7096deabbaf";
        let siteId = "12345";
        let catIab = ['IAB25-3']; // if available - ex.: ["IAB1-5", "IAB1-7"]
        let bannerSizes = [
            [300, 250]
        ];
        const exads_endpoint = 'https://rtb.exads.rocks/rtb.php';
        let adUnits = [];
        // Client Conf end

        let PREBID_TIMEOUT = 5000;
        let userIp = 0;
        let userIpLoaded = false;
        let impression_id = hashCode(new Date().getTime().toString());

        let ip_script = document.createElement("script");
        ip_script.type = "text/javascript";
        ip_script.src = "https://api.ipify.org?format=jsonp&callback=userIpCallback";
        document.getElementsByTagName('head')[0].appendChild(ip_script);

        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];

        // TODO: COMMENT
        pbjs.setConfig({
            debug: true,
            cache: { url: "https://prebid.adnxs.com/pbc/v1/cache" }
        });

        handleRTB();

        // ======== DO NOT EDIT BELOW THIS LINE =========== //
        function userIpCallback(user_ip) {
            userIpLoaded = true;
            if (user_ip.hasOwnProperty('ip')) userIp = user_ip.ip;
        }

        function hashCode(str, seed = 0) {
            let h1 = 0xdeadbeef ^ seed, h2 = 0x41c6ce57 ^ seed;
            for (let i = 0, ch; i < str.length; i++) {
                ch = str.charCodeAt(i);
                h1 = Math.imul(h1 ^ ch, 2654435761);
                h2 = Math.imul(h2 ^ ch, 1597334677);
            }
            h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^ Math.imul(h2 ^ (h2 >>> 13), 3266489909);
            h2 = Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^ Math.imul(h1 ^ (h1 >>> 13), 3266489909);
            return 4294967296 * (2097151 & h2) + (h1 >>> 0);
        }

        function handleRTB() {
            adUnits = [{
                code: 'postbid_iframe',
                mediaTypes: {
                    video: {
                        mimes: ['video/mp4'],
                        context: 'instream', // or 'outstream'
                        protocols: [3, 6],
                        divId: 'player', // required to indicate which player is being used to render this ad unit.
                    }
                },
                bids: [{
                    bidder: 'exadsadserver_rtb_2_4',
                    params: {
                        zoneId: zoneId,
                        fid: fid,
                        siteId: siteId,
                        userIp: 0, // DO NOT EDIT - Client side data
                        impressionId: impression_id.toString(), // DO NOT EDIT - Custom hash
                        stream: {
                            video: {
                                mimes: ['video/mp4']
                            },
                            protocols: [
                                3,
                                6
                            ],
                            ext: {
                                video_cta: 0
                            }
                        },
                        country: 'ITA',
                        keywords: 'lifestyle, humour',
                        catIab: catIab,
                        endpoint: exads_endpoint
                    }
                }]
            }];
        }

        // Init when IP data is available
        function initBids() {
            if (userIpLoaded === false) {
                window.setTimeout(initBids, 50);
            } else {
                for (let i = 0; i < adUnits.length; i++) {
                    for (let t = 0; t < adUnits[i].bids.length; t++) {
                        adUnits[i].bids[t].params.userIp = userIp;
                    }
                }

                pbjs.que.push(function () {
                    pbjs.addAdUnits(adUnits);
                    pbjs.requestBids({
                        timeout: PREBID_TIMEOUT,
                        bidsBackHandler: function (bidResponses) {
                            const bidResponse = bidResponses['postbid_iframe'];
                            if (!bidResponse) {
                                return;
                            }

                            bidResponse.bids.forEach(bid => {
                                initFluidPlayer(bid.vastUrl);

                            });
                        }
                    });
                })
            }
        }


        function initFluidPlayer(vastUrl) {
            var fluidPlayerInstance = fluidPlayer('video-element', {
                vastOptions: {
                    adList: [
                        {
                            roll: 'preRoll',
                            vastTag: vastUrl,
                            adText: 'Advertising supports us directly'
                        },],

                    skipButtonCaption: 'Skip ad in [5]',
                    skipButtonClickCaption: 'Skip ad <span class="skip_button_icon"></span>',
                    adText: null,
                    adTextPosition: 'top left',
                    adCTAText: 'Visit now!',
                    adCTATextPosition: 'bottom right',
                    vastTimeout: 5000,
                    showPlayButton: false,
                    maxAllowedVastTagRedirects: 1,
                }
            });
        }

        initBids();

        // Define the passback HTML tag here.
        // Note that this tag is usually in either Script tag form or iFrame form.
        let passbackTagHtml = '<iframe src="//a.adnflow.com/iframe.php?idzone=88&size=300x250" width="300" height="250" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>';

    </script>

</head>

<body>

    <script>

    </script>

    <h2>Prebid.js Example</h2>
    <h5>Div-1</h5>

    <!-- Your main video element -->
    <video id="video-element">
        <source src="https://vjs.zencdn.net/v/oceans.mp4" type="video/mp4">
    </video>

</body>

</html>